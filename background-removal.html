<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Background Removal</title>
    <link rel="stylesheet" href="styles/navbar.css" />
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        height: 100%;
        font-family: Arial, sans-serif;
        background-color: #000;
        color: #ff0000;
        display: flex;
        flex-direction: column;
      }
      footer {
        background-color: #8b0000;
        color: #fff;
        text-align: center;
        padding: 1em;
        position: sticky;
        top: 0;
        z-index: 10;
      }
      .container {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
        text-align: center;
      }
      .comparison-container {
        position: relative;
        display: inline-block;
        margin: 20px auto;
        overflow: hidden;
        max-width: 100%;
      }
      .comparison-container .image-wrapper,
      .comparison-container .converted-wrapper {
        position: absolute;
        top: 0;
        width: 100%;
        height: 100%;
      }
      .comparison-container img {
        display: block;
        width: 100%;
        height: auto;
        user-drag: none;
        user-select: none;
      }
      .slider {
        position: absolute;
        top: 0;
        bottom: 0;
        left: 50%;
        width: 5px;
        background-color: #fff;
        cursor: ew-resize;
        transform: translateX(-50%);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10;
      }
      .slider::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 40px;
        height: 40px;
        background-color: #000;
        border-radius: 50%;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        transform: translate(-50%, -50%);
        z-index: 11;
      }
      .slider::after {
        content: "\2194";
        font-size: 18px;
        color: #fff;
        position: absolute;
        z-index: 12;
      }
      button {
        background-color: #8b0000;
        color: #fff;
        border: none;
        border-radius: 20px;
        padding: 15px 20px;
        cursor: pointer;
        margin: 10px;
        transition: background-color 0.3s ease;
      }
      button:hover {
        background-color: #ff0000;
      }
      select,
      input[type="checkbox"] {
        padding: 10px;
        margin: 10px;
        border-radius: 10px;
        cursor: pointer;
      }
      .tooltip {
        position: relative;
        display: inline-block;
      }
      .tooltip .tooltiptext {
        visibility: hidden;
        width: 200px;
        background-color: #555;
        color: #fff;
        text-align: center;
        border-radius: 6px;
        padding: 5px;
        position: absolute;
        z-index: 1;
        bottom: 125%;
        left: 50%;
        transform: translateX(-50%);
        opacity: 0;
        transition: opacity 0.3s;
      }
      .tooltip:hover .tooltiptext {
        visibility: visible;
        opacity: 1;
      }
      .form-group {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin: 20px 0;
      }
      .form-group label {
        margin-bottom: 5px;
      }
      .form-group input[type="checkbox"] {
        margin-right: 10px;
      }
      /* Responsive Styles */
      @media (max-width: 768px) {
        nav {
          flex-direction: column;
          align-items: center;
        }
        nav a {
          margin: 10px 0;
        }
        .container {
          padding: 10px;
        }
      }
      @media (max-width: 480px) {
        header,
        footer {
          padding: 0.5em;
        }
        nav a {
          font-size: 0.9em;
          margin: 5px 0;
        }
        .container {
          padding: 5px;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Background Removal</h1>
      <nav>
        <a href="index.html">Home</a>
        <div class="dropdown">
          <a href="#">Audio Tools</a>
          <div class="dropdown-content">
            <a href="audio-converter.html">Audio Converter</a>
          </div>
        </div>
        <div class="dropdown">
          <a href="#">Video Tools</a>
          <div class="dropdown-content">
            <a href="video-converter.html">Video Converter</a>
          </div>
        </div>
        <div class="dropdown">
          <a href="#">Image Tools</a>
          <div class="dropdown-content">
            <a href="image-extraction.html">PDF Image Extraction</a>
            <a href="background-removal.html">Background Removal</a>
            <a href="image-converter.html">Image Converter</a>
          </div>
        </div>
        <div class="dropdown">
          <a href="#">Web Tools</a>
          <div class="dropdown-content">
            <a href="html-validator.html">HTML/CSS Validator</a>
            <a href="json-formatter.html">JSON Formatter</a>
            <a href="regex-tester.html">Regex Tester</a>
            <a href="json-xml-converter.html">JSON-XML Converter</a>
            <a href="code-beautifier.html">Code Beautifier</a>
            <a href="markdown-previewer.html">Markdown Previewer</a>
            <a href="css-minifier.html">CSS Minifier</a>
          </div>
        </div>
        <div class="dropdown">
          <a href="#">Other Tools</a>
          <div class="dropdown-content">
            <a href="password-generator.html">Password Generator</a>
            <a href="finance-tracker.html">Finance Tracker</a>
            <a href="llm.html">Web-Based LLM</a>
          </div>
        </div>
      </nav>
    </header>
    <div class="container">
      <h2>Remove Background from Image</h2>
      <p class="description">
        Use this tool to remove the background from any image seamlessly. Upload
        your image, choose the desired settings, and watch as the background is
        automatically removed. Use the slider to compare the original image with
        the processed one for a clear before-and-after view.
      </p>
      <div id="message"></div>
      <p class="warning">
        Note: This tool relies on an external API for background removal, which
        has limited daily uses. If you encounter issues, try again later or
        check your API usage limits.
      </p>
      <input type="file" id="image-upload" accept="image/*" />
      <div class="form-group">
        <label for="resolution">Resolution:</label>
        <div class="tooltip">
          <select id="resolution">
            <option value="auto">Auto</option>
            <option value="medium">Medium</option>
            <option value="hd">HD</option>
            <option value="full">Full</option>
          </select>
          <span class="tooltiptext">Choose the resolution quality.</span>
        </div>
      </div>
      <div class="form-group">
        <label for="cutout">Cutout Mode:</label>
        <div class="tooltip">
          <select id="cutout">
            <option value="auto">Auto</option>
            <option value="profile">Profile</option>
            <option value="product">Product</option>
            <option value="combined">Combined</option>
          </select>
          <span class="tooltiptext">
            <strong>Auto:</strong> Automatically select the best mode.<br />
            <strong>Profile:</strong> Best for portraits.<br />
            <strong>Product:</strong> Ideal for product images.<br />
            <strong>Combined:</strong> Best for varied backgrounds.
          </span>
        </div>
      </div>
      <div class="form-group">
        <label for="shadow">Add Shadow:</label>
        <div class="tooltip">
          <input type="checkbox" id="shadow" />
          <span class="tooltiptext">
            Add a shadow to make the object stand out.
          </span>
        </div>
      </div>
      <div class="form-group">
        <label for="crop">Crop Image:</label>
        <div class="tooltip">
          <input type="checkbox" id="crop" />
          <span class="tooltiptext">
            Crop the image to fit the object more tightly.
          </span>
        </div>
      </div>
      <div class="form-group">
        <label for="scale">Scale:</label>
        <div class="tooltip">
          <select id="scale">
            <option value="original">Original</option>
            <option value="fit">Fit</option>
            <option value="fill">Fill</option>
          </select>
          <span class="tooltiptext">
            <strong>Original:</strong> Keep the original size.<br />
            <strong>Fit:</strong> Resize to fit within a specified area.<br />
            <strong>Fill:</strong> Resize to fill the specified area.
          </span>
        </div>
      </div>
      <button onclick="removeBackground()">Remove Background</button>
      <div
        class="comparison-container"
        id="comparison-container"
        style="display: none"
      >
        <div class="image-wrapper">
          <img id="original-image" alt="Original Image" />
        </div>
        <div class="converted-wrapper">
          <img id="converted-image" alt="Converted Image" />
        </div>
        <div class="slider" id="slider"></div>
      </div>
      <button
        id="download-button"
        style="display: none"
        onclick="downloadImage()"
      >
        Download Image
      </button>
      <div id="message"></div>
    </div>
    <footer>
      <p>&copy; 2024 Jarrod's Website. All rights reserved.</p>
    </footer>
    <script>
      const apiKeys = [
        "VLiX2psPycMn2dVRfTbUZoip",
        "bWFnyvvguRTCyQ4RDu8kAamd",
        "B7C9AaygMJpwrMskPHucAZra",
      ];
      let downloadUrl;

      document.querySelectorAll(".dropdown").forEach((dropdown) => {
        const dropdownContent = dropdown.querySelector(".dropdown-content");
        dropdown.addEventListener("mouseenter", () => {
          dropdownContent.style.display = "block";
        });
        dropdown.addEventListener("mouseleave", () => {
          dropdownContent.style.display = "none";
        });
        dropdown.querySelector("a").addEventListener("focus", () => {
          dropdownContent.style.display = "block";
        });
        dropdown.querySelector("a").addEventListener("blur", () => {
          dropdownContent.style.display = "none";
        });
      });

      async function removeBackground() {
        const fileInput = document.getElementById("image-upload");
        const comparisonContainer = document.getElementById(
          "comparison-container"
        );
        const originalImage = document.getElementById("original-image");
        const convertedImage = document.getElementById("converted-image");
        const downloadButton = document.getElementById("download-button");
        const message = document.getElementById("message");
        const resolution = document.getElementById("resolution").value;
        const cutout = document.getElementById("cutout").value;
        const shadow = document.getElementById("shadow").checked
          ? "true"
          : "false";
        const crop = document.getElementById("crop").checked ? "true" : "false";
        const scale = document.getElementById("scale").value;

        message.textContent = "";
        downloadButton.style.display = "none";
        comparisonContainer.style.display = "none";

        if (fileInput.files.length === 0) {
          alert("Please choose an image file.");
          return;
        }

        const file = fileInput.files[0];
        const formData = new FormData();
        formData.append("image_file", file);
        formData.append("size", resolution);
        formData.append("type", cutout);
        formData.append("add_shadow", shadow);
        formData.append("crop", crop);
        formData.append("scale", scale);

        message.textContent = "Removing background...";

        for (const key of apiKeys) {
          try {
            const response = await fetch(
              "https://api.remove.bg/v1.0/removebg",
              {
                method: "POST",
                headers: { "X-Api-Key": key },
                body: formData,
              }
            );

            if (response.ok) {
              const blob = await response.blob();
              downloadUrl = URL.createObjectURL(blob);

              originalImage.onload = () => {
                comparisonContainer.style.width = originalImage.width + "px";
                comparisonContainer.style.height = originalImage.height + "px";
                convertedImage.style.width = originalImage.width + "px";
                convertedImage.style.height = originalImage.height + "px";

                comparisonContainer.style.display = "block";
                downloadButton.style.display = "block";
                message.textContent = "Background removed successfully!";
                initComparisons();
              };

              originalImage.src = URL.createObjectURL(file);
              convertedImage.src = downloadUrl;
              return;
            } else if (response.status === 402) {
              message.textContent = `API key ${key} limit exceeded, trying next key...`;
            } else {
              const errorText = await response.text();
              throw new Error(errorText);
            }
          } catch (error) {
            console.error(`Error with API key ${key}:`, error);
            message.textContent = `Error: ${error.message}`;
          }
        }

        message.textContent =
          "An unexpected error occurred or all API keys are exhausted.";
      }

      function downloadImage() {
        const link = document.createElement("a");
        link.href = downloadUrl;
        link.download = "background-removed.png";
        link.click();
      }

      function initComparisons() {
        const slider = document.getElementById("slider");
        const comparisonContainer = document.getElementById(
          "comparison-container"
        );
        const convertedWrapper = document.querySelector(".converted-wrapper");
        const imageWrapper = document.querySelector(".image-wrapper");
        let clicked = false;

        slider.style.left = comparisonContainer.offsetWidth / 2 + "px";
        convertedWrapper.style.clip = `rect(0, ${
          comparisonContainer.offsetWidth / 2
        }px, ${comparisonContainer.offsetHeight}px, 0)`;
        imageWrapper.style.clip = `rect(0, ${
          comparisonContainer.offsetWidth
        }px, ${comparisonContainer.offsetHeight}px, ${
          comparisonContainer.offsetWidth / 2
        }px)`;

        slider.addEventListener("mousedown", () => {
          clicked = true;
          window.addEventListener("mousemove", slideMove);
          window.addEventListener("mouseup", slideStop);
        });

        function slideMove(event) {
          if (!clicked) return;
          slide(getCursorPos(event));
          window.getSelection().removeAllRanges();
        }

        function slideStop() {
          clicked = false;
          window.removeEventListener("mousemove", slideMove);
          window.removeEventListener("mouseup", slideStop);
        }

        function getCursorPos(event) {
          const rect = comparisonContainer.getBoundingClientRect();
          return event.clientX - rect.left;
        }

        function slide(x) {
          const containerWidth = comparisonContainer.offsetWidth;
          x = Math.max(0, Math.min(x, containerWidth));

          slider.style.left = x + "px";
          convertedWrapper.style.clip = `rect(0, ${x}px, ${comparisonContainer.offsetHeight}px, 0)`;
          imageWrapper.style.clip = `rect(0, ${containerWidth}px, ${comparisonContainer.offsetHeight}px, ${x}px)`;
        }
      }
    </script>
  </body>
</html>
