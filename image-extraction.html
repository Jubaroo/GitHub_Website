<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Image Extraction</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #000000;
            color: #FF0000;
            text-align: center;
        }
        header {
            background-color: #8B0000;
            padding: 1em;
            color: #FFFFFF;
            text-align: center;
        }
        nav {
            margin: 20px 0;
        }
        nav a {
            margin: 0 15px;
            text-decoration: none;
            color: #FFFFFF;
            font-weight: bold;
        }
        .container {
            max-width: 800px;
            margin: auto;
            padding: 20px;
        }
        .controls, .navigation, .save-options {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            margin: 10px 0;
        }
        .controls label {
            margin-right: 10px;
        }
        .controls input[type="file"] {
            display: block;
            margin: 0 auto;
        }
        .navigation input[type="number"], .navigation button {
            margin: 5px;
        }
        .save-options select, .save-options button {
            margin: 5px;
        }
        .preview {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            padding: 10px;
        }
        .preview canvas {
            border: none;
            background-color: transparent;
        }
        button, select {
            padding: 10px;
            background-color: #8B0000;
            color: #FFFFFF;
            border: none;
            cursor: pointer;
        }
        button:hover, select:hover {
            background-color: #FF0000;
        }
        footer {
            background-color: #8B0000;
            padding: 1em;
            color: #FFFFFF;
            text-align: center;
            position: fixed;
            bottom: 0;
            width: 100%;
        }
        #message {
            margin-top: 10px;
            font-size: 1em;
            color: #FF0000;
        }
    </style>
</head>
<body>
    <header>
        <h1>Extract Images from PDF</h1>
        <nav>
            <a href="index.html">Home</a>
            <a href="audio-converter.html">Audio Converter</a>
            <a href="image-extraction.html">Image Extraction</a>
            <a href="password-generator.html">Password Generator</a>
            <a href="json-formatter.html">JSON Formatter</a>
            <a href="html-validator.html">HTML/CSS Validator</a>
            <a href="regex-tester.html">Regex Tester</a>
        </nav>
    </header>
    <div class="container">
        <h2>Extract Images from PDF</h2>
        <div class="controls">
            <form id="pdf-form">
                <label for="pdf-file">Choose a PDF file:</label>
                <input type="file" id="pdf-file" accept=".pdf" onchange="loadPDF()">
            </form>
        </div>
        <div class="navigation">
            <button type="button" onclick="prevPage()"><< Prev</button>
            <input type="number" id="page-number" min="1" placeholder="Page" onchange="goToPage()">
            <button type="button" onclick="nextPage()">Next >></button>
            <span id="page-info">Page: 0 / 0</span>
        </div>
        <div class="save-options">
            <label for="format">Save as:</label>
            <select id="format">
                <option value="">Select format</option>
                <option value="png">PNG</option>
                <option value="jpeg">JPEG</option>
            </select>
            <button type="button" onclick="saveCurrentPage()">Save Image</button>
        </div>
        <div class="preview" id="preview"></div>
        <div id="message"></div>
    </div>
    <footer>
        <p>&copy; 2024 Jarrod's Website. All rights reserved.</p>
    </footer>
    <script>
        let pdfDoc = null;
        let currentPage = 1;
        let totalPages = 0;

        async function loadPDF() {
            const fileInput = document.getElementById('pdf-file');
            const previewContainer = document.getElementById('preview');
            const messageElement = document.getElementById('message');
            previewContainer.innerHTML = ''; // Clear previous preview
            messageElement.textContent = ''; // Clear message

            if (fileInput.files.length === 0) {
                alert('Please select a PDF file.');
                return;
            }

            const file = fileInput.files[0];
            const pdfData = new Uint8Array(await file.arrayBuffer());

            pdfjsLib.getDocument({ data: pdfData }).promise.then(async (pdf) => {
                pdfDoc = pdf;
                totalPages = pdf.numPages;
                currentPage = 1;
                document.getElementById('page-info').textContent = `Page: ${currentPage} / ${totalPages}`;
                showPage(currentPage);
            }).catch((err) => {
                alert('Error loading PDF: ' + err.message);
            });
        }

        async function showPage(pageNum) {
            const previewContainer = document.getElementById('preview');
            previewContainer.innerHTML = ''; // Clear previous preview

            const page = await pdfDoc.getPage(pageNum);
            const viewport = page.getViewport({ scale: 1 });
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.height = viewport.height;
            canvas.width = viewport.width;

            await page.render({ canvasContext: context, viewport: viewport }).promise;

            previewContainer.appendChild(canvas);
            document.getElementById('page-info').textContent = `Page: ${currentPage} / ${totalPages}`;
        }

        function nextPage() {
            if (currentPage >= totalPages) return;
            currentPage++;
            showPage(currentPage);
        }

        function prevPage() {
            if (currentPage <= 1) return;
            currentPage--;
            showPage(currentPage);
        }

        function goToPage() {
            const pageNum = parseInt(document.getElementById('page-number').value);
            if (pageNum >= 1 && pageNum <= totalPages) {
                currentPage = pageNum;
                showPage(currentPage);
            } else {
                alert('Invalid page number.');
            }
        }

        function saveCurrentPage() {
            const format = document.getElementById('format').value;
            const messageElement = document.getElementById('message');
            if (!format) {
                messageElement.textContent = 'Please select a format before saving.';
                return;
            }
            savePage(currentPage, format);
        }

        async function savePage(pageNum, format) {
            const page = await pdfDoc.getPage(pageNum);
            const viewport = page.getViewport({ scale: 1 });
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.height = viewport.height;
            canvas.width = viewport.width;

            await page.render({ canvasContext: context, viewport: viewport }).promise;

            const imgData = canvas.toDataURL(`image/${format}`);
            const link = document.createElement('a');
            link.href = imgData;
            link.download = `page_${pageNum}.${format}`;
            link.click();
        }

        document.addEventListener('DOMContentLoaded', () => {
            const script = document.createElement('script');
            script.src = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.6.347/pdf.min.js';
            script.onload = () => {
                pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.6.347/pdf.worker.min.js';
            };
            document.head.appendChild(script);
        });
    </script>
</body>
</html>
